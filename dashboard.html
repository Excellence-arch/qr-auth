<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>EventPass - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./assets/js/main.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="./assets/css/style.css"
    />
    <style>
      .count-up {
        transition: all 1s ease-out;
      }

      .stats-card {
        transition: all 0.3s ease;
        transform: translateY(10px);
        opacity: 0;
      }

      .stats-card.animate {
        transform: translateY(0);
        opacity: 1;
      }

      .page-transition {
        transition: all 0.3s ease;
      }
      .hidden-page {
        opacity: 0;
        transform: translateY(20px);
        pointer-events: none;
        position: absolute;
        width: 100%;
      }
      .active-page {
        opacity: 1;
        transform: translateY(0);
        pointer-events: all;
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .dropdown-menu {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background-color: white;
        min-width: 200px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        z-index: 1;
        border-radius: 0.5rem;
        overflow: hidden;
      }
      .dropdown-menu.show {
        display: block;
      }
      .event-details {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
      }
      .event-details.show {
        max-height: 500px;
        transition: max-height 0.5s ease-in;
      }
      .loading-spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top: 4px solid #3498db;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Water sliding animation */
      @keyframes waterSlideIn {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .water-slide {
        animation: waterSlideIn 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
      }

      /* Delay animations for staggered effect */
      .water-slide:nth-child(1) {
        animation-delay: 0.1s;
      }
      .water-slide:nth-child(2) {
        animation-delay: 0.2s;
      }
      .water-slide:nth-child(3) {
        animation-delay: 0.3s;
      }

      /* Wave loading animation */
      .wave-loading {
        display: inline-block;
        position: relative;
        width: 80px;
        height: 80px;
      }
      .wave-loading div {
        position: absolute;
        width: 16px;
        background: #3b82f6;
        animation: wave-loading 1.2s cubic-bezier(0, 0.5, 0.5, 1) infinite;
      }
      .wave-loading div:nth-child(1) {
        left: 8px;
        animation-delay: -0.24s;
      }
      .wave-loading div:nth-child(2) {
        left: 32px;
        animation-delay: -0.12s;
      }
      .wave-loading div:nth-child(3) {
        left: 56px;
        animation-delay: 0;
      }
      @keyframes wave-loading {
        0% {
          top: 8px;
          height: 64px;
        }
        50%,
        100% {
          top: 24px;
          height: 32px;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen font-sans">
    <!-- Dashboard Layout -->
    <div class="flex h-screen">
      <!-- Sidebar -->
      <div
        class="w-64 bg-gradient-to-b from-teal-500 to-blue-600 text-white shadow-lg"
      >
        <div
          class="p-4 flex items-center justify-center border-b border-white/20"
        >
          <div class="bg-white/20 p-3 rounded-full mr-3">
            <i class="fas fa-calendar-check text-xl"></i>
          </div>
          <h1 class="text-xl font-bold">EventPass</h1>
        </div>
        <nav class="p-4">
          <div class="mb-8">
            <div class="relative group">
              <div
                class="flex items-center justify-between p-3 rounded-lg group-hover:bg-white/10 cursor-pointer transition"
              >
                <div class="flex items-center">
                  <div
                    class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center mr-3"
                  >
                    <i class="fas fa-user"></i>
                  </div>
                  <div>
                    <p
                      class="font-medium"
                      id="username-display"
                    >
                      Loading...
                    </p>
                    <p class="text-xs opacity-80">Admin</p>
                  </div>
                </div>
                <i class="fas fa-chevron-down text-xs"></i>
              </div>
              <div class="dropdown-menu mt-1">
                <a
                  href="profile.html"
                  class="block px-4 py-3 text-gray-700 hover:bg-gray-100"
                  ><i class="fas fa-user mr-2"></i> Profile</a
                >
                <a
                  href="settings.html"
                  class="block px-4 py-3 text-gray-700 hover:bg-gray-100"
                  ><i class="fas fa-cog mr-2"></i> Settings</a
                >
                <a
                  href="#"
                  onclick="logout()"
                  class="block px-4 py-3 text-gray-700 hover:bg-gray-100 relative"
                >
                  <i class="fas fa-sign-out-alt mr-2"></i> Logout
                </a>
              </div>
            </div>
          </div>
          <ul>
            <li class="mb-2">
              <a
                href="dashboard.html"
                class="flex items-center p-3 rounded-lg bg-white/10"
              >
                <i class="fas fa-home mr-3"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li class="mb-2">
              <a
                href="events.html"
                class="flex items-center p-3 rounded-lg hover:bg-white/10 transition"
              >
                <i class="fas fa-calendar-alt mr-3"></i>
                <span>My Events</span>
              </a>
            </li>
            <li class="mb-2">
              <a
                href="attendees.html"
                class="flex items-center p-3 rounded-lg hover:bg-white/10 transition"
              >
                <i class="fas fa-users mr-3"></i>
                <span>Attendees</span>
              </a>
            </li>
            <li class="mb-2">
              <a
                href="reports.html"
                class="flex items-center p-3 rounded-lg hover:bg-white/10 transition"
              >
                <i class="fas fa-chart-bar mr-3"></i>
                <span>Reports</span>
              </a>
            </li>
            <li class="mb-2">
              <a
                href="settings.html"
                class="flex items-center p-3 rounded-lg hover:bg-white/10 transition"
              >
                <i class="fas fa-cog mr-3"></i>
                <span>Settings</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Main Content -->
      <div class="flex-1 overflow-auto">
        <!-- Header -->
        <header
          class="bg-white shadow-sm p-4 flex justify-between items-center"
        >
          <h2 class="text-xl font-semibold text-gray-800">Dashboard</h2>
          <div class="flex items-center space-x-4">
            <button
              onclick="showAddEventModal()"
              class="relative bg-teal-600 hover:bg-teal-700 text-white font-medium py-2 px-4 rounded-lg transition flex items-center"
            >
              <i class="fas fa-plus mr-2"></i> Add Event
            </button>
            <button
              onclick="showAddAttendeeModal()"
              class="relative bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition flex items-center"
            >
              <i class="fas fa-user-plus mr-2"></i> Add Attendee
            </button>
          </div>
        </header>

        <!-- Dashboard Content -->
        <main class="p-6">
          <!-- Stats Cards -->
          <div
            class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"
            id="stats-cards"
          >
            <div
              class="bg-white rounded-xl shadow-sm p-6 card-hover stats-card"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">Total Events</p>
                  <h3
                    class="text-3xl font-bold text-gray-800"
                    id="total-events"
                  >
                    0
                  </h3>
                </div>
                <div class="bg-teal-100 p-3 rounded-full">
                  <i class="fas fa-calendar text-teal-600 text-xl"></i>
                </div>
              </div>
            </div>
            <div
              class="bg-white rounded-xl shadow-sm p-6 card-hover stats-card"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">Total Attendees</p>
                  <h3
                    class="text-3xl font-bold text-gray-800"
                    id="total-attendees"
                  >
                    0
                  </h3>
                </div>
                <div class="bg-blue-100 p-3 rounded-full">
                  <i class="fas fa-users text-blue-600 text-xl"></i>
                </div>
              </div>
            </div>
            <div
              class="bg-white rounded-xl shadow-sm p-6 card-hover stats-card"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-gray-500">Upcoming Events</p>
                  <h3
                    class="text-3xl font-bold text-gray-800"
                    id="upcoming-events"
                  >
                    0
                  </h3>
                </div>
                <div class="bg-purple-100 p-3 rounded-full">
                  <i class="fas fa-clock text-purple-600 text-xl"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Events -->
          <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-8">
            <div class="p-6 border-b border-gray-100">
              <h3 class="text-lg font-semibold text-gray-800">Recent Events</h3>
            </div>
            <div
              class="divide-y divide-gray-100"
              id="recent-events-container"
            >
              <div class="loading-spinner"></div>
            </div>
          </div>

          <!-- Recent Attendees -->
          <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div
              class="p-6 border-b border-gray-100 flex justify-between items-center"
            >
              <h3 class="text-lg font-semibold text-gray-800">
                Recent Attendees
              </h3>
              <a
                href="attendees.html"
                class="text-sm text-blue-600 hover:text-blue-800 font-medium"
                >View All</a
              >
            </div>
            <div
              class="divide-y divide-gray-100"
              id="recent-attendees-container"
            >
              <div class="loading-spinner"></div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Add Event Modal -->
    <div
      id="add-event-modal"
      class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden overflow-y-auto py-8"
    >
      <div
        class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"
      >
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-bold text-gray-800">Add New Event</h3>
          <button
            onclick="hideAddEventModal()"
            class="text-gray-400 hover:text-gray-600"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form
          id="add-event-form"
          class="space-y-4"
        >
          <div>
            <label
              for="event-title"
              class="block mb-2 font-medium text-gray-700"
              >Event Title</label
            >
            <input
              type="text"
              id="event-title"
              required
              class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
            />
          </div>
          <div>
            <label
              for="event-description"
              class="block mb-2 font-medium text-gray-700"
              >Description</label
            >
            <textarea
              id="event-description"
              rows="3"
              class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
            ></textarea>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label
                for="event-start-date"
                class="block mb-2 font-medium text-gray-700"
                >Start Date</label
              >
              <input
                type="date"
                id="event-start-date"
                required
                class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
              />
            </div>
            <div>
              <label
                for="event-end-date"
                class="block mb-2 font-medium text-gray-700"
                >End Date</label
              >
              <input
                type="date"
                id="event-end-date"
                class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label
                for="event-start-time"
                class="block mb-2 font-medium text-gray-700"
                >Start Time</label
              >
              <input
                type="time"
                id="event-start-time"
                class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
              />
            </div>
            <div>
              <label
                for="event-end-time"
                class="block mb-2 font-medium text-gray-700"
                >End Time</label
              >
              <input
                type="time"
                id="event-end-time"
                class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
              />
            </div>
          </div>
          <div>
            <label
              for="event-location"
              class="block mb-2 font-medium text-gray-700"
              >Location</label
            >
            <input
              type="text"
              id="event-location"
              class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
            />
          </div>
          <div>
            <label
              for="event-capacity"
              class="block mb-2 font-medium text-gray-700"
              >Capacity</label
            >
            <input
              type="number"
              id="event-capacity"
              class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
            />
          </div>

          <div class="flex items-center mt-4">
            <input
              type="checkbox"
              id="event-is-public"
              checked
              class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
            />
            <label
              for="event-is-public"
              class="ml-2 text-sm font-medium text-gray-700"
              >Public Event</label
            >
          </div>

          <div class="flex justify-end space-x-3 pt-4">
            <button
              type="button"
              onclick="hideAddEventModal()"
              class="px-4 py-2 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded-lg font-medium text-white transition"
            >
              Save Event
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Attendee Modal -->
    <div
      id="add-attendee-modal"
      class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-bold text-gray-800">Add New Attendee</h3>
          <button
            onclick="hideAddAttendeeModal()"
            class="text-gray-400 hover:text-gray-600"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form
          id="add-attendee-form"
          class="space-y-4"
        >
          <div>
            <label
              for="attendee-name"
              class="block mb-2 font-medium text-gray-700"
              >Full Name</label
            >
            <input
              type="text"
              id="attendee-name"
              required
              class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
            />
          </div>
          <div>
            <label
              for="attendee-email"
              class="block mb-2 font-medium text-gray-700"
              >Email</label
            >
            <input
              type="email"
              id="attendee-email"
              required
              class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
            />
          </div>
          <div>
            <label
              for="attendee-phone"
              class="block mb-2 font-medium text-gray-700"
              >Phone</label
            >
            <input
              type="tel"
              id="attendee-phone"
              class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
            />
          </div>
          <div>
            <label
              for="attendee-event"
              class="block mb-2 font-medium text-gray-700"
              >Event</label
            >
            <select
              id="attendee-event"
              required
              class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
            >
              <option value="">Select an event</option>
            </select>
          </div>
          <div>
            <label
              for="attendee-ticket"
              class="block mb-2 font-medium text-gray-700"
              >Ticket Type</label
            >
            <select
              id="attendee-ticket"
              class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
            >
              <option value="standard">Standard</option>
              <option value="vip">VIP</option>
              <option value="student">Student</option>
            </select>
          </div>
          <div class="flex justify-end space-x-3 pt-4">
            <button
              type="button"
              onclick="hideAddAttendeeModal()"
              class="px-4 py-2 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium text-white transition"
            >
              Add Attendee
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Global state
      let appState = {
        user: null,
        events: [],
        attendees: [],
        analytics: null,
      };

      // API base URL
      const API_BASE_URL = 'http://localhost:5000/api/v1';

      // Load all data when DOM is loaded
      document.addEventListener('DOMContentLoaded', async function () {
        const authToken = localStorage.getItem('authToken');
        if (!authToken) {
          window.location.href = 'index.html';
        }

        // Initialize dropdown menus
        initDropdowns();

        // Load all data
        await loadAllData();
      });
      // Initialize dropdown menus
      function initDropdowns() {
        const dropdownToggles = document.querySelectorAll('.group');
        dropdownToggles.forEach((toggle) => {
          toggle.addEventListener('click', function (e) {
            const menu = this.querySelector('.dropdown-menu');
            menu.classList.toggle('show');

            // Close other dropdowns
            document.querySelectorAll('.dropdown-menu').forEach((otherMenu) => {
              if (otherMenu !== menu) {
                otherMenu.classList.remove('show');
              }
            });
          });
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function (e) {
          if (!e.target.closest('.group')) {
            document.querySelectorAll('.dropdown-menu').forEach((menu) => {
              menu.classList.remove('show');
            });
          }
        });
      }

      // Load all data from API
      async function loadAllData() {
        try {
          // Show loading state
          document.getElementById('recent-events-container').innerHTML = `
        <div class="p-6 flex justify-center">
          <div class="wave-loading">
            <div></div><div></div><div></div>
          </div>
        </div>`;

          document.getElementById('recent-attendees-container').innerHTML = `
        <div class="p-6 flex justify-center">
          <div class="wave-loading">
            <div></div><div></div><div></div>
          </div>
        </div>`;

          // Load user data
          const userResponse = await fetch(`${API_BASE_URL}/auth/user`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('authToken')}`,
            },
          });
          if (!userResponse.ok) {
            window.location.href = 'login.html';
          }
          const userData = await userResponse.json();
          appState.user = userData.data.user;
          document.getElementById('username-display').textContent =
            appState.user.username;

          // Load user's events
          const eventsResponse = await fetch(`${API_BASE_URL}/event/account`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('authToken')}`,
            },
          });
          const eventsData = await eventsResponse.json();
          appState.events = eventsData.data.events;

          // Load analytics data
          const analyticsResponse = await fetch(
            `${API_BASE_URL}/auth/user/dashboard-analytics`,
            {
              headers: {
                Authorization: `Bearer ${localStorage.getItem('authToken')}`,
              },
            }
          );
          const analyticsData = await analyticsResponse.json();
          appState.analytics = analyticsData.data;

          // Update UI with loaded data
          updateDashboardStats();
          renderRecentEvents();
          renderRecentAttendees();
          populateEventDropdown();
        } catch (error) {
          console.error('Error loading data:', error);
          showToast('Failed to load data. Please try again.', 'error');
        }
      }

      // Populate event dropdown in add attendee modal
      function populateEventDropdown() {
        const select = document.getElementById('attendee-event');

        // Clear existing options except the first one
        while (select.options.length > 1) {
          select.remove(1);
        }

        // Add events from state
        appState.events.forEach((event) => {
          const option = document.createElement('option');
          option.value = event._id;
          option.textContent = event.name;
          select.appendChild(option);
        });
      }

      // Form submissions
      document
        .getElementById('add-attendee-form')
        .addEventListener('submit', async function (e) {
          e.preventDefault();

          const submitButton = this.querySelector('button[type="submit"]');
          setButtonLoading(submitButton, true);

          const formData = {
            name: document.getElementById('attendee-name').value,
            email: document.getElementById('attendee-email').value,
            phone: document.getElementById('attendee-phone').value,
            eventId: document.getElementById('attendee-event').value,
            ticketType: document.getElementById('attendee-ticket').value,
            code: { used: false },
          };

          try {
            const response = await fetch(`${API_BASE_URL}/attendee/add`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${localStorage.getItem('authToken')}`,
              },
              body: JSON.stringify(formData),
            });

            const data = await response.json();

            if (!response.ok) {
              throw new Error(data.message || 'Failed to add attendee');
            }

            showToast('Attendee added successfully!', 'success');
            await loadAllData(); // Refresh data
            hideAddAttendeeModal();
            this.reset();
          } catch (error) {
            console.error('Error adding attendee:', error);
            showToast(
              error.message || 'Failed to add attendee. Please try again.',
              'error'
            );
          } finally {
            setButtonLoading(submitButton, false);
          }
        });

      // Update dashboard statistics
      function updateDashboardStats() {
        // In the updateDashboardStats function, add this:
        if (appState.analytics.upcomingEvents?.length > 0) {
          const upcomingContainer = document.getElementById(
            'upcoming-events-container'
          );
          if (upcomingContainer) {
            upcomingContainer.innerHTML = appState.analytics.upcomingEvents
              .map(
                (event) => `
        <div class="p-4 border-b border-gray-100">
          <div class="flex items-center justify-between">
            <div>
              <h4 class="font-medium">${event.name}</h4>
              <p class="text-sm text-gray-500">
                ${formatDate(event.startDate)} • ${event.location}
              </p>
            </div>
            <span class="${getStatusClass(event.status)}">
              ${getStatusText(event.status)}
            </span>
          </div>
        </div>
      `
              )
              .join('');
          }
        }

        // Animate stats cards
        const statsCards = document.querySelectorAll(
          '#stats-cards .stats-card'
        );
        statsCards.forEach((card, index) => {
          setTimeout(() => {
            card.classList.add('animate');
          }, index * 150);
        });

        // Count-up animation for numbers
        animateValue(
          'total-events',
          0,
          appState.analytics.totalEvents || 0,
          1000
        );
        animateValue(
          'total-attendees',
          0,
          appState.analytics.totalAttendees || 0,
          1000
        );
        animateValue(
          'upcoming-events',
          0,
          appState.analytics.upcomingEvents?.length || 0,
          1000
        );
      }

      // Helper function for count-up animation
      function animateValue(id, start, end, duration) {
        const element = document.getElementById(id);
        if (!element) return;

        let startTimestamp = null;
        const step = (timestamp) => {
          if (!startTimestamp) startTimestamp = timestamp;
          const progress = Math.min((timestamp - startTimestamp) / duration, 1);
          element.textContent = Math.floor(progress * (end - start) + start);
          if (progress < 1) {
            window.requestAnimationFrame(step);
          }
        };
        window.requestAnimationFrame(step);
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          month: 'short',
          day: 'numeric',
          year: 'numeric',
        });
      }

      function formatTime(timeString) {
        if (!timeString) return '';
        // Assuming timeString is in HH:MM format
        const [hours, minutes] = timeString.split(':');
        const hour = parseInt(hours);
        const ampm = hour >= 12 ? 'PM' : 'AM';
        const hour12 = hour % 12 || 12;
        return `${hour12}:${minutes} ${ampm}`;
      }

      function formatDateRange(startDate, endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);

        if (start.toDateString() === end.toDateString()) {
          return formatDate(startDate);
        }

        if (
          start.getMonth() === end.getMonth() &&
          start.getFullYear() === end.getFullYear()
        ) {
          return `${start.getDate()} - ${formatDate(endDate)}`;
        }

        if (start.getFullYear() === end.getFullYear()) {
          return `${start.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric',
          })} - ${formatDate(endDate)}`;
        }

        return `${formatDate(startDate)} - ${formatDate(endDate)}`;
      }

      // Render recent events with real data
      function renderRecentEvents() {
        const container = document.getElementById('recent-events-container');

        if (
          !appState.analytics ||
          !appState.analytics.recentEvents ||
          appState.analytics.recentEvents.length === 0
        ) {
          container.innerHTML =
            '<div class="p-6 text-center text-gray-500">No recent events found</div>';
          return;
        }

        container.innerHTML = appState.analytics.recentEvents
          .map(
            (event, index) => `
            <div class="p-6 hover:bg-gray-50 transition cursor-pointer water-slide" style="opacity: 0; animation-delay: ${
              index * 0.1
            }s">
              <div class="flex items-center justify-between">
                <div>
                  <h4 class="font-medium text-gray-800">${event.name}</h4>
                  <p class="text-sm text-gray-500 mt-1">
                    ${formatDateRange(event.startDate, event.endDate)} • ${
              event.location
            }
                    ${event.startTime ? `• ${formatTime(event.startTime)}` : ''}
                    ${event.endTime ? `- ${formatTime(event.endTime)}` : ''}
                  </p>
                </div>
                <div class="flex items-center">
                  <span class="${getStatusClass(event.status)}">
                    ${getStatusText(event.status)}
                  </span>
                  <span class="ml-4 text-gray-800 font-medium">
                    ${event.attendeesCount} / ${event.capacity} attendees
                  </span>
                  <button onclick="toggleEventDetails(this)" class="ml-4 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-chevron-down"></i>
                  </button>
                </div>
              </div>
              <div class="event-details mt-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-4">
                  <div>
                    <p class="text-sm text-gray-500">Description</p>
                    <p class="text-gray-800 mt-1">${event.description}</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">Details</p>
                    <p class="text-gray-800 mt-1">
                      <div>${formatDate(event.startDate)} ${
              event.startTime ? formatTime(event.startTime) : ''
            }</div>
                      <div>to ${formatDate(event.endDate)} ${
              event.endTime ? formatTime(event.endTime) : ''
            }</div>
                      <div>${event.location}</div>
                      ${
                        event.isPublic
                          ? '<div class="text-green-600">Public Event</div>'
                          : '<div class="text-blue-600">Private Event</div>'
                      }
                    </p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">Attendance</p>
                    <p class="text-gray-800 mt-1">
                      <div>${event.attendeesCount} registered</div>
                      <div>${
                        event.capacity - event.attendeesCount
                      } spots remaining</div>
                      <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                        <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${
                          (event.attendeesCount / event.capacity) * 100
                        }%"></div>
                      </div>
                    </p>
                  </div>
                </div>
                <div class="flex justify-end mt-4 space-x-2">
                  <button class="text-sm bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-1.5 px-3 rounded-lg transition">
                    <i class="fas fa-edit mr-1"></i> Edit
                  </button>
                  <button class="text-sm bg-red-100 hover:bg-red-200 text-red-800 font-medium py-1.5 px-3 rounded-lg transition">
                    <i class="fas fa-trash mr-1"></i> Delete
                  </button>
                </div>
              </div>
            </div>
          `
          )
          .join('');
      }

      // Render recent attendees with real data
      function renderRecentAttendees() {
        const container = document.getElementById('recent-attendees-container');

        if (
          !appState.analytics ||
          !appState.analytics.recentAttendees ||
          appState.analytics.recentAttendees.length === 0
        ) {
          container.innerHTML =
            '<div class="p-6 text-center text-gray-500">No recent attendees found</div>';
          return;
        }

        container.innerHTML = appState.analytics.recentAttendees
          .map(
            (attendee, index) => `
      <div class="p-4 hover:bg-gray-50 transition water-slide" style="opacity: 0; animation-delay: ${
        index * 0.1
      }s">
        <div class="flex items-center">
          <div class="w-10 h-10 rounded-full ${getInitialsColor(
            index
          )} flex items-center justify-center text-white font-medium mr-4">
            ${getInitials(attendee.name)}
          </div>
          <div class="flex-1">
            <h4 class="font-medium text-gray-800">${attendee.name}</h4>
            <p class="text-sm text-gray-500">${attendee.email}</p>
          </div>
          <div class="text-sm text-gray-500">${attendee.eventName}</div>
          <div class="ml-4">
            <span class="text-xs font-medium px-2.5 py-0.5 rounded-full bg-blue-100 text-blue-800">
              Registered
            </span>
          </div>
        </div>
      </div>
    `
          )
          .join('');
      }

      // Populate event dropdown in add attendee modal
      function populateEventDropdown() {
        const select = document.getElementById('attendee-event');

        // Clear existing options except the first one
        while (select.options.length > 1) {
          select.remove(1);
        }

        // Add events from state
        appState.events.forEach((event) => {
          const option = document.createElement('option');
          option.value = event.id;
          option.textContent = event.name;
          select.appendChild(option);
        });
      }

      // Helper functions
      function formatDateRange(startDate, endDate) {
        const start = new Date(startDate);
        const end = new Date(endDate);

        if (startDate === endDate) {
          return start.toLocaleDateString('en-US', {
            month: 'long',
            day: 'numeric',
            year: 'numeric',
          });
        }

        if (
          start.getMonth() === end.getMonth() &&
          start.getFullYear() === end.getFullYear()
        ) {
          return `${start.toLocaleDateString('en-US', {
            month: 'long',
            day: 'numeric',
          })}-${end.toLocaleDateString('en-US', {
            day: 'numeric',
            year: 'numeric',
          })}`;
        }

        if (start.getFullYear() === end.getFullYear()) {
          return `${start.toLocaleDateString('en-US', {
            month: 'long',
            day: 'numeric',
          })} - ${end.toLocaleDateString('en-US', {
            month: 'long',
            day: 'numeric',
            year: 'numeric',
          })}`;
        }

        return `${start.toLocaleDateString()} - ${end.toLocaleDateString()}`;
      }

      function getStatusClass(status) {
        const classes = {
          active: 'bg-blue-100 text-blue-800',
          completed: 'bg-green-100 text-green-800',
          upcoming: 'bg-yellow-100 text-yellow-800',
          cancelled: 'bg-red-100 text-red-800',
        };
        return `text-xs font-medium px-2.5 py-0.5 rounded-full ${
          classes[status] || 'bg-gray-100 text-gray-800'
        }`;
      }

      function getStatusText(status) {
        const texts = {
          active: 'Active',
          completed: 'Completed',
          upcoming: 'Upcoming',
          cancelled: 'Cancelled',
        };
        return texts[status] || status;
      }

      function getAttendeeStatusClass(status) {
        const classes = {
          'checked-in': 'bg-green-100 text-green-800',
          registered: 'bg-yellow-100 text-yellow-800',
          cancelled: 'bg-red-100 text-red-800',
          waiting: 'bg-gray-100 text-gray-800',
        };
        return `text-xs font-medium px-2.5 py-0.5 rounded-full ${
          classes[status] || 'bg-gray-100 text-gray-800'
        }`;
      }

      function getAttendeeStatusText(status) {
        const texts = {
          'checked-in': 'Checked In',
          registered: 'Registered',
          cancelled: 'Cancelled',
          waiting: 'Waiting List',
        };
        return texts[status] || status;
      }

      function getInitials(name) {
        return name
          .split(' ')
          .map((part) => part[0])
          .join('')
          .toUpperCase();
      }

      function getInitialsColor(id) {
        const colors = [
          'bg-teal-500',
          'bg-blue-500',
          'bg-purple-500',
          'bg-pink-500',
          'bg-red-500',
          'bg-orange-500',
          'bg-yellow-500',
          'bg-green-500',
          'bg-indigo-500',
        ];
        return colors[id % colors.length];
      }

      // Toggle event details
      function toggleEventDetails(button) {
        const eventItem = button.closest('.p-6');
        const details = eventItem.querySelector('.event-details');
        details.classList.toggle('show');

        const icon = button.querySelector('i');
        if (details.classList.contains('show')) {
          icon.classList.remove('fa-chevron-down');
          icon.classList.add('fa-chevron-up');
        } else {
          icon.classList.remove('fa-chevron-up');
          icon.classList.add('fa-chevron-down');
        }
      }

      // Add Event Modal
      function showAddEventModal() {
        document.getElementById('add-event-modal').classList.remove('hidden');
      }

      function hideAddEventModal() {
        document.getElementById('add-event-modal').classList.add('hidden');
      }

      // Add Attendee Modal
      function showAddAttendeeModal() {
        document
          .getElementById('add-attendee-modal')
          .classList.remove('hidden');
      }

      function hideAddAttendeeModal() {
        document.getElementById('add-attendee-modal').classList.add('hidden');
      }

      // Form submissions
      document
        .getElementById('add-event-form')
        .addEventListener('submit', async function (e) {
          e.preventDefault();

          const submitButton = this.querySelector('button[type="submit"]');
          setButtonLoading(submitButton, true);

          const formData = {
            name: document.getElementById('event-title').value,
            description: document.getElementById('event-description').value,
            startDate: document.getElementById('event-start-date').value,
            endDate: document.getElementById('event-end-date').value,
            startTime: document.getElementById('event-start-time').value,
            endTime: document.getElementById('event-end-time').value,
            location: document.getElementById('event-location').value,
            capacity: document.getElementById('event-capacity').value,
            isPublic: document.getElementById('event-is-public').checked,
          };

          try {
            const response = await fetch('http://localhost:5000/api/v1/event', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${localStorage.getItem('authToken')}`,
              },
              body: JSON.stringify(formData),
            });

            const data = await response.json();

            if (!response.ok) {
              throw new Error(data.message || 'Failed to create event');
            }

            showToast('Event created successfully!', 'success');
            // Refresh the events list
            await loadAllData();
            hideAddEventModal();
            this.reset();
          } catch (error) {
            console.error('Error adding event:', error);
            showToast(
              error.message || 'Failed to add event. Please try again.',
              'error'
            );
          } finally {
            setButtonLoading(submitButton, false);
          }
        });

      // Logout function
      function logout() {
        const logoutButton = document.querySelector('a[onclick="logout()"]');
        setButtonLoading(logoutButton, true);

        showToast('Logging out...', 'info', 2000);
        setTimeout(() => {
          localStorage.removeItem('authToken');
          localStorage.removeItem('username');
          window.location.href = 'index.html';
        }, 2000);
      }
    </script>
    <!-- Toast Notifications Container -->
    <div
      id="toast-container"
      class="toast-container"
    ></div>
  </body>
</html>
